<?phprequire_once ("../library.inc.php");$id = (isset ($_GET["id"]) ? $_GET["id"] : NULL);$action = (isset ($_GET["action"]) ? $_GET["action"] : NULL);$authenticate = (isset ($_GET["authenticate"]) ? $_GET["authenticate"] : NULL);if ($action && $id && $authenticate){	$sql = "SELECT * FROM `transactions` WHERE `id` = '$id' AND `authenticate` = '$authenticate' AND `status` = '1'";	$result = mysql_query ($sql);	if ($transaction = mysql_fetch_assoc ($result))	{		switch ($transaction["type"])		{			case 2: // request info				if ($action == "yes")				{					// mark transaction approved					$sql = "UPDATE `transactions` SET `status` = '2' WHERE `id` = '$id'";					mysql_query ($sql);					$creator_email = true;					$sql = "SELECT * FROM `contacts` AS c JOIN `email_associations` AS a ON a.`contact_id` = c.`contact_id` JOIN `emails` AS e ON e.`email_id` = a.`email_id` WHERE c.`contact_id` = '{$transaction["creator"]}' LIMIT 1";					$result = mysql_query ($sql);					if ($creator = mysql_fetch_assoc ($result))					{						mail_html (Name ($transaction["creator"], "%n %L <{$creator["email"]}>"), Name ($transaction["contact"], "%n %L's Information"), "<html>\n<head>\n<link rel=\"stylesheet\" href=\"http://www.cottonwoodgulch.org/components/stylesheet.css\">\n</head>\n<body>\n" . SimpleSummary ($transaction["contact"]) . "\n</body>\n</html>\n", "From: Online Rosters <database@cottonwoodgulch.org>");					}					else					{						$creator_email = false;					}										$contact_email = true;					$sql = "SELECT * FROM `contacts` AS c JOIN `email_associations` AS a ON a.`contact_id` = c.`contact_id` JOIN `emails` AS e ON e.`email_id` = a.`email_id` WHERE c.`contact_id` = '{$transaction["contact"]}' LIMIT 1";					$result = mysql_query ($sql);					if ($contact = mysql_fetch_assoc ($result))					{						mail_html (Name ($transaction["contact"], "%n %L <{$contact["email"]}>"), Name ($transaction["creator"], "%n %L's Information"), "<html>\n<head>\n<link rel=\"stylesheet\" href=\"http://www.cottonwoodgulch.org/components/stylesheet.css\">\n</head>\n<body>\n" . SimpleSummary ($transaction["creator"]) . "\n</body>\n</html>\n", "From: Online Rosters <database@cottonwoodgulch.org>");					}					else					{						$contact_email = false;					}										if (!$creator_email && $contact_email)					{						$sql = "UPDATE `transactions` SET `status` = '6' WHERE `id` = '$id'";						mysql_query ($sql);					}					else if ($creator_email && !$contact_email)					{						$sql = "UPDATE `transactions` SET `status` = '7' WHERE `id` = '$id'";						mysql_query ($sql);					}					else if (!$creator_email && !$contact_email)					{						$sql = "UPDATE `transactions` SET `status` = '8' WHERE `id` = '$id'";						mysql_query ($sql);					}?><html><head><link rel="stylesheet" href="http://www.cottonwoodgulch.org/components/stylesheet.css"></head><body><h3>Thank you!</h3><p><?php echo Name ($transaction["creator"], "%n %L"); ?> will receive an email shortly with your contact information. You will also receive an email in the near future with his or her contact information. If you have any questions or concerns, please do not hesitate to contact the Cottonwood Gulch webmaster <a href="mailto:webmaster@cottonwoodgulch.org">webmaster</a>.</p></body></html><?php					exit();				}				else if ($action == "no")				{					// mark transaction approved					$sql = "UPDATE `transactions` SET `status` = '3' WHERE `id` = '$id'";					mysql_query ($sql);					$creator_email = true;					$sql = "SELECT * FROM `contacts` AS c JOIN `email_associations` AS a ON a.`contact_id` = c.`contact_id` JOIN `emails` AS e ON e.`email_id` = a.`email_id` WHERE c.`contact_id` = '{$transaction["creator"]}' LIMIT 1";					$result = mysql_query ($sql);					if ($creator = mysql_fetch_assoc ($result))					{						$html = "<html>\n<head>\n<link rel=\"stylesheet\" href=\"http://www.cottonwoodgulch.org/components/stylesheet.css\">\n</head>\n<body>\n<h3>I'm Sorry</h3>\n<p>" . Name ($transaction["contact"], "%n %L") . " has turned down your request for his or her contact information. If you have any questions or concerns, please contact the Cottonwood Gulch webmaster at <a href=\"mailto:webmaster@cottonwoodgulch.org\">webmaster@cottonwoodgulch.org</a>.</p>\n</body>\n</html>\n";						mail_html (Name ($transaction["creator"], "%n %L <{$creator["email"]}>"), "Information Request Denied", $html, "From: Online Rosters <database@cottonwoodgulch.org>");					}					else					{						$sql = "UPDATE `transactions` SET `status` = '9' WHERE `id` = '$id'";						mysql_query ($sql);					}?><html><head><link rel="stylesheet" href="http://www.cottonwoodgulch.org/components/stylesheet.css"></head><body><h3>Thank you!</h3><p><?php echo Name ($transaction["creator"], "%n %L"); ?> will <i>not</i> receive your contact information, nor will you receive his or hers in return. If you have any questions or concerns, please do not hesitate to contact the Cottonwood Gulch webmaster <a href="mailto:webmaster@cottonwoodgulch.org">webmaster</a>.</p></body></html><?php					exit();				}				break;		}	}}?><html><head><link rel="stylesheet" href="http://www.cottonwoodgulch.org/components/stylesheet.css"></head><body><h3>I'm sorry - An error has occurred!</h3><p>You are not able to perform the action that you requested. This could be for a number of reasons:</p><ol><li>The requested action is not possible for the specified transacton.<li>You have already modified this transaction in such a way that you cannot perform further modifications.<li>There is an error in this script.<li>You are attempting to do something that you are not allowed to do.</ol><p>If you believe that you have received this message in error, please contact the Cottonwood Gulch webmaster at <a href="mailto:webmaster@cottonwoodgulch.org">webmaster@cottonwoodgulch.org</a>.</p></body></html>