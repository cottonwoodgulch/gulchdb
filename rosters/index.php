<?phprequire_once "../library.inc.php";session_start ();header("Cache-control: private"); // IE 6$form = (isset ($_POST["form"]) ? $_POST["form"] : NULL);$name = (isset ($_POST["name"]) ? $_POST["name"] : NULL);$year = (isset ($_POST["year"]) ? $_POST["year"] : NULL);$roster = (isset ($_POST["roster"]) ? $_POST["roster"] : NULL);$flag = (isset ($_GET["flag"]) ? stripslashes ($_GET["flag"]) : NULL);if (!isset ($_SESSION["authenticated"]) || $_SESSION["authenticated"] !== true){	$_SESSION["login_redirect"] = "index.php";	header ("Location: login.php");}$now = getdate();if ($now["mon"] >= 9){	$curr_year = $now["year"] + 1;}else{	$curr_year = $now["year"];}$curr_year--;$sql = "SELECT * FROM `rosters` WHERE `year` >= '1926' AND `year` < '$curr_year' GROUP BY `year` ORDER BY `year` DESC";$years = mysql_query ($sql) or header ("Location: index.php?flag=MySQL+error+(I1)");if (($name !== NULL) && strlen ($name) > 0){	$names = NameSearch ($name, "JOIN `roster_memberships` AS m ON m.`contact_id` = c.`contact_id` JOIN `rosters` AS r ON r.`roster_id` = m.`roster_id` JOIN `groups` AS g ON g.`group_id` = r.`group_id`", "g.`excluded` = '0' AND r.`year` < '$curr_year' and r.`year` > '0'", "`primary_name` ASC, `first_name` ASC, `year` ASC", NULL, "index.php?flag=MySQL+error+(I2)");}if ($year !== NULL){	$sql = "SELECT * FROM `groups` AS g JOIN `rosters` AS r ON g.`group_id` = r.`group_id` WHERE r.`year` = '$year' AND g.`excluded` = '0' ORDER BY g.`group` ASC";	$rosters = mysql_query ($sql) or header ("Location: index.php?flag=MySQL+error+(I3)");}if (($form == "rosters") && ($roster !== NULL)){	$sql = "SELECT * FROM `rosters` WHERE `roster_id` = '$roster' AND `year` = '$year'";	$ready = mysql_query ($sql);	if (mysql_num_rows ($ready) == 1)	{		header ("Location: roster.php?id=$roster");	}	else	{		$roster = NULL;	}}DocType();?><html><head>	<link rel="stylesheet" href="../../../components/stylesheet.css">	<link rel="stylesheet" href="section.css">	<script src="../../../javascript/lib.js"></script></head><body><table class="toolbar" width="98%">	<tr>		<td nowrap><a href="logout.php">Log out</a></td>		<td width="100%"align="right" nowrap>Online Group Rosters</td>	</tr></table><p class="name">Welcome <?php echo Name ($_SESSION["cid"], "%n"); ?>!</p><h3>Search the Cottonwood Gulch Rosters</h3><?phpif ($flag != ""){	echo "<p class=\"flag\">A $flag has occurred and you were redirected to this page. If this error persists, please contact <a href=\"mailto:webmaster@cottonwoodgulch.org\">the webmaster.</a></p>\n";}?><form name="name" method="post" action="index.php"><input name="form" type="hidden" value="name"><?phpif ($year !== NULL){	echo "<input name=\"year\" type=\"hidden\" value=\"$year\">\n";}?><dl>	<dt>Find a Person	<dd><table>	<tr>		<td><input name="name" type="text"<?php echo ($name !== NULL ? " value=\"$name\"" : ""); ?>></td>		<td><input type="submit" value="Find"></td>	</tr></table></dl><?phpif (isset ($names)){	if (mysql_num_rows ($names) > 0)	{		echo "<dl>\n\t<dt>The following matches were found for \"$name\":</p>\n";		$id = NULL;		while ($n = mysql_fetch_assoc ($names))		{			if ($id != $n["contact_id"])			{				$last = NULL;				if ($id !== NULL)				{					echo "\n\t\t</dl>\n";				}				$id = $n["contact_id"];				$count = 0;				echo "\t<dd>\n\t\t<dl>\n\t\t\t<dt><a href=\"person.php?id=" . $n["contact_id"] . "\">" . str_replace(" \"\"", "", Name ($n["contact_id"], "%F \"%N\" %M %L %D")) . "</a> " . RosterYears ($n["contact_id"]) . "\n";			}			// this needs major cleanup			if ($n["year"] != $last)			{				//echo ($count++ == 0 ? "\t\t\t<dd>" : ", ") . $n["year"];			}			$last = $n["year"];		}		echo "\n\t\t</dl>\n\t</dl>\n";	}	else	{		echo "<dl>\n\t<dt>No matches found for \"$name\"\n\t<dl>\n\t\t<dt>Hint\n\t\t<dd>If you can't find someone, try looking for just their first inital -- \"J Smith\" instead of \"Jane Smith\" -- this may match \"Jayne Smith\" instead.\n\t</dl>\n</dl>\n";	}}?></form><form name="rosters" method="post" action="index.php"><input name="form" type="hidden" value="rosters"><?phpif ($name !== NULL){	echo "<input name=\"name\" type=\"hidden\" value=\"$name\">\n";}?><dl>	<dt>		<th>Find a Roster</th>	<dd><table>	<tr>		<td class="label">Choose a year</td><?phpif ((isset ($rosters)) && (mysql_num_rows ($rosters) > 1)){	echo "\t\t<td class=\"label\">Choose an expedition</td>\n";}?>	<tr>		<td><select name="year" onchange="document.rosters.submit();"><?phpwhile ($y = mysql_fetch_assoc ($years)){	$y = $y["year"];	echo "\t\t\t<option value=\"$y\"" . ($year === $y ? " selected" : "") . ">$y</option>\n";}?>		</select></td><?phpif ((isset ($rosters)) && (mysql_num_rows ($rosters) > 1)){	echo "\t\t<td><select name=\"roster\">\n";	while ($r = mysql_fetch_assoc ($rosters))	{		echo "\t\t\t<option value=\"" . $r["roster_id"] . "\"" . ($roster === $r["roster_id"] ? " selected" : "") . ">" . $r["group"] . "</option>\n";	}	echo "\t\t</select></td>\n";}else if ((isset ($rosters)) && (mysql_num_rows ($rosters) == 1)){	$r = mysql_fetch_assoc ($rosters);	echo "\t\t<td style=\"padding-right: 20px;\"><input name=\"roster\" type=\"hidden\" value=\"" . $r["roster_id"] . "\">" . $r["group"] . "</td>\n";}?>		<td><input type="submit" value="Go"></td>	</tr></table></dl></form></body>