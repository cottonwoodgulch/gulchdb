<?phpsession_start();header ("Cache-control: private"); // IE 6require_once ("../library.inc.php");if (! isset ($_SESSION["login_redirect"])){	$_SESSION["login_redirect"] = "index.php";}$mode = "email";$first = $last = $email = $city = $postal_code = $flag = NULL;while (list ($key, $value) = each ($_GET)){	switch ($key)	{		case "flag":			$flag = stripslashes (urldecode ($value));			break;		default:			$$key = urldecode($value);	}}while (list ($key, $value) = each ($_POST)){	switch ($key)	{		default:			$$key = $value;	}}if (($first != "") && ($last != "")){	if ($mode == "email")	{		if ($email != "")		{			$sql = "SELECT * FROM `contacts` AS c JOIN `email_associations` AS ea ON ea.`contact_id` = c.`contact_id` JOIN `emails` AS e ON e.`email_id` = ea.`email_id` WHERE c.`primary_name` = '$last' AND (c.`first_name` = '$first' OR c.`nickname` = '$first' OR c.`middle_name` = '$first') AND e.`email` = '$email' LIMIT 1";			$result = mysql_query ($sql) or header ("Location: login.php?redirect=" . urlencode ($redirect) . "$flag=" . urlencode ("A MySQL error (L1) has occurred. If this error persists, please contact the <a href=\"mailto:webmaster@cottonwoodgulch.org\">webmaster</a>.") . "&first=$first&last=$last&email=$email");			if (mysql_num_rows ($result) == 0)			{				$flag = "The name and email address that you entered could not be found in our database. You may want to try to <a href=\"login.php?mode=mailing&first=$first&last=$last\">log in using your mailing address</a>, or you may want to try a different variation on your name (e.g. what you were called as a Trekker). If you continue to have problems loggint in, please contact the <a href=\"mailto:webmaster@cottonwoodgulch.org\">webmaster</a>.";			}			else			{				$person = mysql_fetch_assoc ($result);				$_SESSION["cid"] = $person["contact_id"];				$_SESSION["authenticated"] = true;				header ("Location: " . $_SESSION["login_redirect"]);			}		}		else		{			$flag = "You must enter an email address to log in.";		}	}	else if ($mode == "mailing")	{		if (($city != "") &&  ($postal_code != ""))		{			$sql = "SELECT * FROM `contacts` AS c JOIN `address_associations` AS aa ON aa.`contact_id` = c.`contact_id` JOIN `addresses`	AS a ON a.`address_id` = aa.`address_id` WHERE c.`primary_name` = '$last' AND (c.`first_name` = '$first' OR c.`nickname` = '$first' OR c.`middle_name` = '$first') AND a.`city` = '$city' AND (a.`postal_code` = '$postal_code' OR a.`postal_code` LIKE '$postal_code-%') LIMIT 1";			$result = mysql_query ($sql) or header ("Location: login.php?redirect=" . urlencode ($redirect) . "$flag=" . urlencode ("A MySQL error (L2) has occurred. If this error persists, please contact the <a href=\"mailto:webmaster@cottonwoodgulch.org\">webmaster</a>.") . "&mode=mailing&first=$first&last=$last&city=$city&postal_code=$postal_code");			if (mysql_num_rows ($result) == 0)			{				$flag = "The name and mailing address you entered could not be found in our database." . (strlen ($postal_code) < 5 ? " If you live in the United States, please make sure that you are using the standard 5-digit zip code for your address." : "") . " If you are unsure which address to use, please check the mailing label on your most recent newsletter.";			}			else			{				$person = mysql_fetch_assoc ($result);				$_SESSION["cid"] = $person["contact_id"];				$_SESSION["authenticated"] = true;				header ("Location: " . $_SESSION["login_redirect"]);			}		}		else		{			$flag = "You must enter both a city and postal code to log in.";		}	}	else	{		header ("Location: login.php?redirect=" . urlencode ($redirect));	}}DocType();?><html><head>	<link rel="stylesheet" href="../../../components/stylesheet.css">	<link rel="stylesheet" href="section.css">	<script type="text/javascript" src="../../../javascript/lib.js"></script></head><body><table class="toolbar" width="98%">	<tr>		<td width="100%" align="right">&nbsp;Online Group Rosters&nbsp;</td>	</tr></table><h3>Please Login</h3><p>Please enter your first and last name and your <?php echo $mode; ?> address to access the Online Rosters.<?php echo ($mode == "email" ? " If you do not have an email address (or your email address is not in our database), you can try <a href=\"login.php?mode=mailing&first=$first&last=$last\">logging in with your mailing address</a>." : " The best address to use is the address to which your most recent newsletter was mailed. (<a href=\"login.php?mode=email&first=$first&last=$last\">Switch back to email login</a>)"); ?></p><?php	if ($flag !== NULL)	{		echo "<p class=\"flag\">$flag</p>\n";	}?><form method="post" action="login.php<?php echo ($mode == "mailing" ? "?mode=mailing" : ""); ?>"><table>	<tr>		<td class="label2">First</td>		<td><input name="first" type="text" value="<?php echo $first; ?>"></td>	</tr>	<tr>		<td class="label2">Last</td>		<td><input name="last" type="text" value="<?php echo $last; ?>"></td>	</tr>	<tr><?phpif ($mode != "mailing"){	echo "\t\t<td class=\"label2\">Email</td>\n\t\t<td><input name=\"email\" type=\"text\" value=\"$email\"></td>\n";}else{	echo "\t\t<td class=\"label2\">City</td>\n\t\t<td><input name=\"city\" type=\"text\" value=\"$city\"></td>\n\t</tr>\n\t<tr>\n";	echo "\t\t<td class=\"label2\">Postal Code</td>\n\t\t<td><input name=\"postal_code\" type=\"text\" value=\"$postal_code\"></td>\n";}?>	</tr></table><p><input name="button" type="submit" value="Login"></p></form></body></html>