CREATE  TEMPORARY  TABLE ta( SELECT c1.contact_id, a.address_id, at.rank, min( at.rank )  AS min_a_rankFROM contacts AS c1JOIN address_associations AS aa ON aa.contact_id = c1.contact_idJOIN addresses AS a ON a.address_id = aa.address_idJOIN address_types AS at ON at.address_type_id = a.address_type_idGROUP  BY c1.contact_idHAVING at.rank = min_a_rankORDER  BY c1.contact_id ASC , at.rank ASC );SELECT d.donation_id AS id, sum( d.amount )  AS total, title, first_name, middle_name, primary_name, nickname, degree, amount, purpose, anonymous, street_address_1, street_address_2, city, state, postal_code, countryFROM contacts AS cJOIN ta ON ta.contact_id = c.contact_idJOIN addresses AS a ON a.address_id = ta.address_idLEFT  JOIN titles AS t ON t.title_id = c.title_idLEFT  JOIN degrees AS deg ON deg.degree_id = c.degree_idJOIN donation_associations AS da ON da.contact_id = c.contact_idJOIN donations AS d ON d.donation_id = da.donation_idWHERE d.date >=  '2003-10-1' AND d.date <  '2004-9-30'GROUP  BY c.contact_id/* HAVING total >=[variable] */ORDER  BY country ASC , postal_code ASC , primary_name ASC , first_name ASC LIMIT 0 , 1000;